
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Capstone S.E</title>

    <!-- Bootstrap core CSS-->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template-->
    <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <!-- Page level plugin CSS-->
    <link href="/vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="/css/sb-admin.css" rel="stylesheet">

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
</head>
<body id="page-top">
<nav class="navbar navbar-expand navbar-dark bg-dark static-top">
    <a class="navbar-brand mr-1" href="/main">S.E</a>
    <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
        <i class="fas fa-bars"></i>
    </button>
    <!-- Navbar Search -->
    <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
        <div class="input-group">
            <input type="text" class="form-control" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
            <div class="input-group-append">
                <button class="btn btn-primary" type="button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </form>

    <!-- Navbar -->
    <ul class="navbar-nav ml-auto ml-md-0">
        <li class="nav-item dropdown no-arrow mx-1">
            <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-bell fa-fw"></i>
                <span class="badge badge-danger">9+</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
            </div>
        </li>
        <li class="nav-item dropdown no-arrow mx-1">
            <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-envelope fa-fw"></i>
                <span class="badge badge-danger">7</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="messagesDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
            </div>
        </li>
        <li class="nav-item dropdown no-arrow">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-user-circle fa-fw"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                <a class="dropdown-item" href="#">Settings</a>
                <a class="dropdown-item" href="#">Activity Log</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Logout</a>
            </div>
        </li>
    </ul>

</nav>

<div id="wrapper">


    <!-- Sidebar -->
    <ul class="sidebar navbar-nav">
        <li class="nav-item active">
            <a class="nav-link" href="/main">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>Main</span>
            </a>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-fw fa-folder"></i>
                <span>Pages</span>
            </a>
            <div class="dropdown-menu" aria-labelledby="pagesDropdown">
                <h6 class="dropdown-header">Login Screens:</h6>
                <a class="dropdown-item" href="login.html">Login</a>
                <a class="dropdown-item" href="/addMember">Member Register</a>
                <a class="dropdown-item" href="/addPanel">Panel Register</a>
                <a class="dropdown-item" href="forgot-password.html">Forgot Password</a>
                <div class="dropdown-divider"></div>

            </div>
        </li>

        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="tablesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-fw fa-table"></i>
                <span>Tables</span>
            </a>
            <div class="dropdown-menu" aria-labelledby="pagesDropdown">
                <h6 class="dropdown-header">Table Screens:</h6>
                <a class="dropdown-item" href="/memberList">Member</a>
                <a class="dropdown-item" href="/panelList">Panel</a>
            </div>
        </li>
    </ul>

    <div id="content-wrapper">

        <div class="container-fluid">

            <!-- Breadcrumbs-->
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="/main">Main</a>
                </li>
                <li class="breadcrumb-item active">
                    Graph Status</li>
            </ol>

            <!-- DataTables Example -->
            <div class="card mb-3">
                <div class="card-header">
                    <i class="fas fa-table"></i>
                    일사량 현황 그래프</div>

                <h4 align="right" style="margin-right: -32%">
                    <div class="container show-grid" style="width: 700px;">
                        <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
                        <br>

                        <button type="button" class="btn btn-warning btn-sm"  onclick="window.location.href='/historyChart/{{name}}'">오류 목록 확인</button>
                        &nbsp
                        <!-- Indicates a successful or positive action -->
                        <button type="button" class="btn btn-danger btn-sm" onclick="window.location.href='/damageList'">고장 목록 확인</button>

                    </div>
                    <!--<button onclick="window.location.href='logChart.html'">로그 기록 확인</button>-->
                    <!--<button onclick="window.location.href='damageList.html'">고장 기록 확인</button>-->
                </h4>


                <div id="Line_Controls_Chart">
                    <!-- 라인 차트 생성할 영역 -->
                    <div id="lineChartArea" style="padding:0px 20px 0px 0px;"></div>
                    <!-- 컨트롤바를 생성할 영역 -->
                    <div id="controlsArea" style="padding:0px 20px 0px 0px;"></div>
                </div>
            </div>
            <script>
                function getTimeStamp(data) {
                    var d = new Date(data);
                    var s =
                        leadingZeros(d.getFullYear(), 4) + '-' +
                        leadingZeros(d.getMonth() + 1, 2) + '-' +
                        leadingZeros(d.getDate(), 2) + ' ' +

                        leadingZeros(d.getHours(), 2) + ':' +
                        leadingZeros(d.getMinutes(), 2) + ':' +
                        leadingZeros(d.getSeconds(), 2);

                    return s;
                }

                function leadingZeros(n, digits) {
                    var zero = '';
                    n = n.toString();

                    if (n.length < digits) {
                        for (i = 0; i < digits - n.length; i++)
                            zero += '0';
                    }
                    return zero + n;
                }


                var chartDrowFun = {

                    chartDrow : function(){
                        var chartData = '';

                        //날짜형식 변경하고 싶으시면 이 부분 수정하세요.
                        var chartDateformat     = 'yyyy년MM월dd일HH시mm분ss초';
                        //라인차트의 라인 수
                        var chartLineCount    = 10;
                        //컨트롤러 바 차트의 라인 수
                        var controlLineCount    = 10;

                        function drawDashboard() {



                            var data = new google.visualization.DataTable();
                            var dataRow = [];

                            //그래프에 표시할 컬럼 추가
                            data.addColumn('datetime' , '날짜');
                            data.addColumn('number'   , '센서 일사량');
                            data.addColumn('number'   , '패널 일사량');

                            //  그래프에 표시할 데이터
                            var number = {{name}};
                            console.log("1");
                            console.log(number);
                            fetch('http://localhost:8080/api/collectors/'+number).then(function (response) {
                                response.text().then(function (text) {
                                    var list = $.parseJSON(text);
                                    var listLen = list.length;
                                    var contentStr = new Array();
                                    console.log(list);

                                    for (var i = 0; i < listLen; i++) {
                                        var panel = list[i].panelIrradiation;
                                        var sensor = list[i].sensorIrradiation;


                                        var dt1 = + new Date(list[i].time);

                                        // console.log("++2 " + (dt1+3200));
                                        var dt = new Date(list[i].time);
                                        var today =  + new Date();
                                        // console.log("today " + today);
                                        // console.log("++1 " + dt1);
                                        // console.log("+++++++" + dt+43200);
                                        //   console.log("++dt"+ dt);
                                        //if(today < (dt1+43200000)) {
                                            dt = getTimeStamp(dt);
                                            var year = dt.substr(0, 4); // 2018

                                            var month = dt.substr(5, 2); // 10
                                            var day = dt.substr(8, 2); // 23
                                            var hour = dt.substr(11, 2); // 07
                                            var minute = dt.substr(14, 2); //47
                                            var second = dt.substr(17,2);
                                            // console.log("year " + year);
                                            // console.log(" month " + month);
                                            // console.log(" day " + day);
                                            // console.log(" minute " + minute);
                                            // console.log("second " + second);


                                            dataRow = [new Date(year,month, day, hour, minute,second), panel, sensor];
                                            console.log("dataRow " + dataRow);
                                            data.addRow(dataRow);
                                      //  }
                                    }
                                })
                            })




                            // for(var i = 0; i <= 31; i++){ //랜덤 데이터 생성
                            //     var total   = Math.floor(Math.random() * 300) + 1;
                            //     var man     = total - 10;
                            //
                            //
                            //     dataRow = [new Date(year, month, i ,day), man, total];
                            //     data.addRow(dataRow);
                            // }


                            var logChart = new google.visualization.ChartWrapper({
                                chartType   : 'LineChart',
                                containerId : 'lineChartArea', //라인 차트 생성할 영역
                                options     : {
                                    isStacked   : 'percent',
                                    focusTarget : 'category',
                                    height          : 500,
                                    width              : '100%',
                                    legend          : { position: "top", textStyle: {fontSize: 13}},
                                    pointSize        : 5,
                                    tooltip          : {textStyle : {fontSize:12}, showColorCode : true,trigger: 'both'},
                                    hAxis              : {format: chartDateformat, gridlines:{count:chartLineCount,units: {
                                                years : {format: ['yyyy년']},
                                                months: {format: ['MM월']},
                                                days  : {format: ['dd일']},
                                                hours : {format: ['HH시']},
                                                minutes : {format: ['mm분']},
                                                seconds : {format: ['ss초']}
                                            }
                                        },textStyle: {fontSize:12}},
                                    vAxis              : {minValue: 100,viewWindow:{min:0},gridlines:{count:-1},textStyle:{fontSize:12}},
                                    animation        : {startup: true,duration: 1000,easing: 'in' },
                                    annotations    : {pattern: chartDateformat,
                                        textStyle: {
                                            fontSize: 15,
                                            bold: true,
                                            italic: true,
                                            color: '#871b47',
                                            auraColor: '#d799ae',
                                            opacity: 0.8,
                                            pattern: chartDateformat
                                        }
                                    }
                                }
                            });


                            var control = new google.visualization.ControlWrapper({
                                controlType: 'ChartRangeFilter',
                                containerId: 'controlsArea',  //control bar를 생성할 영역
                                options: {
                                    ui:{
                                        chartType: 'LineChart',
                                        chartOptions: {
                                            chartArea: {'width': '60%','height' : 80},
                                            hAxis: {'baselineColor': 'none', format: chartDateformat, textStyle: {fontSize:12},
                                                gridlines:{count:controlLineCount,units: {
                                                        years : {format: ['yyyy년']},
                                                        months: {format: ['MM월']},
                                                        days  : {format: ['dd일']},
                                                        hours : {format: ['HH시']},
                                                        minutes : {format: ['mm분']},
                                                        seconds : {format: ['ss초']}
                                                    }
                                                }}
                                        }
                                    },
                                    filterColumnIndex: 0
                                }
                            });

                            var date_formatter = new google.visualization.DateFormat({ pattern: chartDateformat});
                            date_formatter.format(data, 0);

                            var dashboard = new google.visualization.Dashboard(document.getElementById('Line_Controls_Chart'));
                            window.addEventListener('resize', function() { dashboard.draw(data); }, false); //화면 크기에 따라 그래프 크기 변경
                            dashboard.bind([control], [logChart]);
                            dashboard.draw(data);

                        }
                        google.charts.setOnLoadCallback(drawDashboard);


                    }
                };

                $(document).ready(function(){
                        google.charts.load('current', {'packages':['line','controls']});
                        chartDrowFun.chartDrow(); //chartDrow() 실행
                    });
                </script>

            </div>



        </div>
        <!-- /.container-fluid -->


        <!-- Sticky Footer -->
        <footer class="sticky-footer">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>Copyright 2018. S.E all rights reserved.</span>
                </div>
            </div>
        </footer>

    </div>
    <!-- /.content-wrapper -->

</div>
<!-- /#wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


<!-- Logout Modal-->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                <a class="btn btn-primary" href="login.html">Logout</a>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap core JavaScript-->
<script src="/vendor/jquery/jquery.min.js"></script>
<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Page level plugin JavaScript-->
<script src="/vendor/datatables/jquery.dataTables.js"></script>
<script src="/vendor/datatables/dataTables.bootstrap4.js"></script>

<!-- Custom scripts for all pages-->
<script src="/js/sb-admin.min.js"></script>

<!-- Demo scripts for this page-->
<script src="/js/demo/datatables-demo.js"></script>

</body>

</html>